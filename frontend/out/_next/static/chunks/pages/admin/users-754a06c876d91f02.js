(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[635],{2257:function(e,r,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/users",function(){return s(6694)}])},9046:function(e,r,s){"use strict";s.d(r,{Z:function(){return i}});var t=s(5893),n=s(1664),a=s.n(n),o=s(1013),l=s(7294);function i(e){let{children:r}=e,[s,n]=(0,l.useState)(null),[a,i]=(0,l.useState)(null),[c,m]=(0,l.useState)(!1);(0,l.useEffect)(()=>{n((0,o.cY)()),i((0,o.Ms)())},[]);let u="ADMIN"===s,p="SR_REGISTRAR"===s,h="DO"===s;return(0,t.jsxs)("div",{style:{minHeight:"100vh",display:"flex",background:"#f6f6f6",fontFamily:"sans-serif"},children:[(0,t.jsxs)("aside",{className:"print-hidden",onMouseEnter:()=>m(!1),onMouseLeave:()=>m(!0),style:{width:c?"70px":"240px",background:"#0C512F",color:"white",transition:"width 0.25s ease",overflow:"hidden",boxShadow:"2px 0 5px rgba(0,0,0,0.1)"},children:[(0,t.jsxs)("div",{style:{padding:"1rem",borderBottom:"1px solid rgba(255,255,255,0.15)",display:"flex",alignItems:"center",gap:"0.75rem"},children:[(0,t.jsx)("img",{src:"/ogra-logo.png",alt:"OGRA Logo",style:{width:"36px",height:"36px",objectFit:"contain"}}),!c&&(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{style:{fontWeight:700,fontSize:"0.95rem",lineHeight:"1.2"},children:"OGRA Dashboard"}),(0,t.jsx)("div",{style:{fontSize:"0.7rem",opacity:.8},children:"ADMIN"===s?"REGISTRAR":"".concat(a||"DO User"," (").concat(s||"No Role",")")})]})]}),(0,t.jsxs)("nav",{style:{padding:"0.75rem 0.5rem"},children:[(0,t.jsx)(d,{href:"/admin",label:"Dashboard",collapsed:c}),(u||p||h)&&(0,t.jsx)(d,{href:"/admin/complaints",label:"Complaints",collapsed:c}),(h||u)&&(0,t.jsx)(d,{href:"/admin/do",label:"DO Dashboard",collapsed:c}),(u||p)&&(0,t.jsx)(d,{href:"/admin/company-dashboard",label:"Company Dashboard",collapsed:c}),u&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d,{href:"/admin/users",label:"Manage Users",collapsed:c}),(0,t.jsx)(d,{href:"/admin/master-data",label:"Form Settings",collapsed:c})]})]}),(0,t.jsx)("div",{style:{marginTop:"auto",padding:"1rem",borderTop:"1px solid rgba(255,255,255,0.15)"},children:(0,t.jsx)("button",{onClick:()=>{(0,o.qz)(),window.location.href="/admin/login"},style:{width:"100%",padding:"0.5rem",background:"#3AA469",border:"none",borderRadius:"4px",color:"white",fontSize:"0.8rem",cursor:"pointer"},children:c?"âŽ‹":"Logout"})})]}),(0,t.jsx)("main",{style:{flex:1,padding:"1.5rem"},children:(0,t.jsx)("div",{style:{maxWidth:1300,margin:"0 auto"},children:r})})]})}function d(e){let{href:r,label:s,collapsed:n}=e;return(0,t.jsx)("div",{style:{marginBottom:"0.3rem"},children:(0,t.jsxs)(a(),{href:r,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.45rem 0.6rem",borderRadius:"6px",textDecoration:"none",color:"white",fontSize:"0.85rem",transition:"background 0.2s, transform 0.1s"},children:[(0,t.jsx)("span",{style:{width:"8px",height:"8px",background:"#3AA469",borderRadius:"50%"}}),!n&&(0,t.jsx)("span",{style:{fontSize:"0.85rem"},children:s})]})})}},3139:function(e,r,s){"use strict";s.d(r,{S:function(){return n}});let t="https://complaint.ogra.org.pk";if(!t){let{protocol:e,hostname:r}=window.location;t="".concat(e,"//").concat(r,":5000")}t||(t="http://localhost:5000");let n="https://complaint.ogra.org.pk"},1013:function(e,r,s){"use strict";function t(){return localStorage.getItem("token")||null}function n(e){e&&localStorage.setItem("token",e)}function a(){localStorage.removeItem("token"),localStorage.removeItem("role"),localStorage.removeItem("username")}function o(){let e=t();return e?{Authorization:"Bearer "+e}:{}}function l(e,r){e&&localStorage.setItem("role",e),r&&localStorage.setItem("username",r)}function i(){return localStorage.getItem("role")}function d(){return localStorage.getItem("username")}s.d(r,{$V:function(){return o},IO:function(){return l},LP:function(){return t},Ms:function(){return d},cY:function(){return i},o4:function(){return n},qz:function(){return a}})},6694:function(e,r,s){"use strict";s.r(r),s.d(r,{default:function(){return d}});var t=s(5893),n=s(7294),a=s(7066),o=s(9046),l=s(3139),i=s(1013);function d(){let[e,r]=(0,n.useState)([]),[s,d]=(0,n.useState)(!1),[c,m]=(0,n.useState)(!1),[u,p]=(0,n.useState)(""),[h,g]=(0,n.useState)(""),[x,f]=(0,n.useState)({username:"",email:"",password:"",role:"DO"}),[y,b]=(0,n.useState)(null),[w,j]=(0,n.useState)(null),[S,v]=(0,n.useState)(""),[D,k]=(0,n.useState)(!1),[C,B]=(0,n.useState)(null),R=(0,i.cY)(),F=async()=>{d(!0),p("");try{let e=await a.Z.get(l.S+"/api/users",{headers:(0,i.$V)()});r(e.data||[])}catch(e){console.error(e),p("Failed to load users. Please check backend connection.")}finally{d(!1)}};(0,n.useEffect)(()=>{F()},[]);let z=()=>{p(""),g("")},E=async e=>{if(e.preventDefault(),z(),!x.username.trim()){p("Username is required.");return}if(!x.email.trim()){p("Email is required.");return}if(!x.password.trim()){p("Password is required.");return}try{m(!0),await a.Z.post(l.S+"/api/users",{username:x.username.trim(),email:x.email.trim(),password:x.password.trim(),role:"DO"},{headers:(0,i.$V)()}),g("Dealing Officer (DO) user created successfully."),f({username:"",email:"",password:"",role:"DO"}),b(null),F()}catch(e){var r,s;console.error(e),p((null==e?void 0:null===(s=e.response)||void 0===s?void 0:null===(r=s.data)||void 0===r?void 0:r.message)||"Could not save user. Username may already exist.")}finally{m(!1)}},N=async e=>{if(e.preventDefault(),y){if(z(),!x.username.trim()){p("Username is required.");return}if(!x.email.trim()){p("Email is required.");return}try{m(!0),await a.Z.patch("".concat(l.S,"/api/users/").concat(y.id),{username:x.username.trim(),email:x.email.trim(),role:x.role},{headers:(0,i.$V)()}),x.password&&x.password.trim()&&await a.Z.post("".concat(l.S,"/api/users/").concat(y.id,"/reset-password"),{password:x.password.trim()},{headers:(0,i.$V)()}),g('User "'.concat(y.username,'" updated successfully.')),f({username:"",email:"",password:"",role:"DO"}),b(null),F()}catch(e){var r,s;console.error(e),p((null==e?void 0:null===(s=e.response)||void 0===s?void 0:null===(r=s.data)||void 0===r?void 0:r.message)||"Could not save user. Username may already exist.")}finally{m(!1)}}},A=async()=>{if(w){if(z(),!S.trim()){p("New password is required for reset.");return}try{k(!0),await a.Z.post("".concat(l.S,"/api/users/").concat(w.id,"/reset-password"),{password:S.trim()},{headers:(0,i.$V)()}),g('Password reset for user "'.concat(w.username,'" successfully.')),j(null),v("")}catch(s){var e,r;console.error(s),p((null==s?void 0:null===(r=s.response)||void 0===r?void 0:null===(e=r.data)||void 0===e?void 0:e.message)||"Failed to reset password. Please try again.")}finally{k(!1)}}},I=async e=>{if(window.confirm('Are you sure you want to delete "'.concat(e.username,'"?'))){z(),B(e.id);try{await a.Z.delete("".concat(l.S,"/api/users/").concat(e.id),{headers:(0,i.$V)()}),g('User "'.concat(e.username,'" deleted successfully.')),w&&w.id===e.id&&(j(null),v("")),y&&y.id===e.id&&(b(null),f({username:"",email:"",password:"",role:"DO"})),F()}catch(e){var r,s;console.error(e),p((null==e?void 0:null===(s=e.response)||void 0===s?void 0:null===(r=s.data)||void 0===r?void 0:r.message)||"Failed to delete user. Please try again.")}finally{B(null)}}};return"ADMIN"!==R?(0,t.jsx)(o.Z,{children:(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("h1",{style:{fontSize:"1.2rem",color:"#DC2626"},children:"Access Denied"}),(0,t.jsx)("p",{style:{color:"#666"},children:"Only Main Admin can manage users."})]})}):(0,t.jsx)(o.Z,{children:(0,t.jsxs)("div",{className:"card",style:{background:"white",borderRadius:10,padding:"1.4rem"},children:[(0,t.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"1rem",gap:"0.5rem",flexWrap:"wrap"},children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{style:{fontSize:"1.3rem",color:"#0C512F",marginBottom:"0.2rem"},children:"Manage Users"}),(0,t.jsx)("p",{style:{fontSize:"0.85rem",color:"#4B5563",margin:0},children:"Create DO users and edit Admin / SR. Registrar / DO accounts."})]}),(0,t.jsxs)("div",{style:{fontSize:"0.8rem",padding:"0.25rem 0.6rem",borderRadius:999,background:"#ECFDF3",color:"#166534",border:"1px solid #BBF7D0",whiteSpace:"nowrap"},children:["Total Users: ",(0,t.jsx)("strong",{children:e.length})]})]}),u&&(0,t.jsx)("div",{style:{background:"#FEE2E2",borderRadius:6,padding:"0.5rem 0.75rem",color:"#B91C1C",fontSize:"0.85rem",marginBottom:"0.6rem",border:"1px solid #FCA5A5"},children:u}),h&&(0,t.jsx)("div",{style:{background:"#DCFCE7",borderRadius:6,padding:"0.5rem 0.75rem",color:"#166534",fontSize:"0.85rem",marginBottom:"0.6rem",border:"1px solid #86EFAC"},children:h}),(0,t.jsxs)("div",{style:{border:"1px solid #E5E7EB",borderRadius:10,padding:"0.9rem",marginBottom:"1.1rem",background:"#F9FAFB"},children:[(0,t.jsx)("h2",{style:{fontSize:"1rem",color:"#0C512F",marginBottom:"0.6rem"},children:y?"Edit User":"Create New DO User"}),(0,t.jsxs)("form",{onSubmit:e=>y?N(e):E(e),style:{display:"grid",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",gap:"0.6rem 0.8rem",alignItems:"flex-end"},children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{style:{display:"block",fontSize:"0.8rem",marginBottom:4,color:"#4B5563"},children:"Username"}),(0,t.jsx)("input",{className:"input",placeholder:"eg. do_lahore",value:x.username,onChange:e=>f(r=>({...r,username:e.target.value}))}),(0,t.jsx)("small",{style:{fontSize:"0.7rem",color:"#6B7280"},children:"Used to login. Must be unique."})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{style:{display:"block",fontSize:"0.8rem",marginBottom:4,color:"#4B5563"},children:"Official Email"}),(0,t.jsx)("input",{className:"input",type:"email",placeholder:"eg. do.lhr@ogra.org.pk",value:x.email,onChange:e=>f(r=>({...r,email:e.target.value}))}),(0,t.jsx)("small",{style:{fontSize:"0.7rem",color:"#6B7280"},children:"Used for email notifications."})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{style:{display:"block",fontSize:"0.8rem",marginBottom:4,color:"#4B5563"},children:y?"New Password (optional)":"Password"}),(0,t.jsxs)("div",{style:{display:"flex",gap:"0.35rem",alignItems:"center"},children:[(0,t.jsx)("input",{type:"text",className:"input",placeholder:y?"Leave blank to keep current password":"Set or generate password",value:x.password,onChange:e=>f(r=>({...r,password:e.target.value}))}),(0,t.jsx)("button",{type:"button",className:"btn",onClick:()=>{let e="ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz23456789!@#$",r="";for(let s=0;s<10;s++)r+=e[Math.floor(Math.random()*e.length)];f(e=>({...e,password:r})),g("Random password generated. Please share it securely with the user."),p("")},style:{whiteSpace:"nowrap",fontSize:"0.75rem",padding:"0.35rem 0.6rem",borderRadius:6,border:"1px solid #D1D5DB",background:"white"},children:"Generate"})]}),(0,t.jsx)("small",{style:{fontSize:"0.7rem",color:"#6B7280"},children:y?"If you set a new password here, it will overwrite the old one.":"Share password securely with the user."})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{style:{display:"block",fontSize:"0.8rem",marginBottom:4,color:"#4B5563"},children:"Role"}),(0,t.jsxs)("select",{className:"input",value:x.role,onChange:e=>f(r=>({...r,role:e.target.value})),children:[(0,t.jsx)("option",{value:"DO",children:"DO"}),(0,t.jsx)("option",{value:"SR_REGISTRAR",children:"SR_REGISTRAR"}),(0,t.jsx)("option",{value:"ADMIN",children:"ADMIN"})]}),(0,t.jsx)("small",{style:{fontSize:"0.7rem",color:"#6B7280"},children:"For new users this screen is intended for DO accounts."})]}),(0,t.jsxs)("div",{style:{gridColumn:"1 / -1",display:"flex",gap:"0.5rem"},children:[(0,t.jsx)("button",{className:"btn-primary",style:{border:"none",padding:"0.55rem 0.9rem",borderRadius:6,background:"#0C512F",color:"white",fontSize:"0.85rem"},disabled:c,type:"submit",children:c?y?"Updating...":"Creating...":y?"Update User":"Create DO User"}),y&&(0,t.jsx)("button",{type:"button",className:"btn",onClick:()=>{b(null),f({username:"",email:"",password:"",role:"DO"}),z()},style:{padding:"0.55rem 0.9rem",borderRadius:6,border:"1px solid #D1D5DB",background:"white",fontSize:"0.8rem"},children:"Cancel Edit"})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{style:{fontSize:"1rem",color:"#0C512F",marginBottom:"0.5rem"},children:"Existing Users"}),s?(0,t.jsx)("div",{style:{fontSize:"0.9rem",color:"#4B5563"},children:"Loading users..."}):0===e.length?(0,t.jsx)("div",{style:{fontSize:"0.85rem",color:"#6B7280"},children:"No users created yet."}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"0.85rem",marginTop:"0.4rem"},children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{style:{background:"#0C512F",color:"white"},children:[(0,t.jsx)("th",{align:"left",style:{padding:"8px"},children:"Username"}),(0,t.jsx)("th",{align:"left",style:{padding:"8px"},children:"Email"}),(0,t.jsx)("th",{align:"left",style:{padding:"8px"},children:"Role"}),(0,t.jsx)("th",{align:"left",style:{padding:"8px"},children:"Actions"})]})}),(0,t.jsx)("tbody",{children:e.map((e,r)=>(0,t.jsxs)("tr",{style:{borderTop:"1px solid #E5E7EB",background:r%2==0?"white":"rgba(249, 250, 251, 0.9)"},children:[(0,t.jsx)("td",{style:{padding:"6px 8px"},children:(0,t.jsx)("span",{style:{fontWeight:500},children:e.username})}),(0,t.jsx)("td",{style:{padding:"6px 8px",color:"#374151"},children:e.email||"-"}),(0,t.jsx)("td",{style:{padding:"6px 8px"},children:(0,t.jsx)("span",{style:{padding:"2px 8px",borderRadius:999,fontSize:"0.7rem",background:"#EFF6FF",color:"#1D4ED8",border:"1px solid #BFDBFE"},children:e.role})}),(0,t.jsxs)("td",{style:{padding:"6px 8px",display:"flex",gap:"0.4rem",flexWrap:"wrap"},children:[(0,t.jsx)("button",{type:"button",className:"btn",onClick:()=>{b(e),f({username:e.username||"",email:e.email||"",password:"",role:e.role||"DO"}),z()},style:{fontSize:"0.75rem",padding:"0.3rem 0.6rem",borderRadius:6,border:"1px solid #D1D5DB",background:"white",color:"#0C512F"},children:"Edit"}),(0,t.jsx)("button",{type:"button",className:"btn",onClick:()=>{j(e),v(""),z()},style:{fontSize:"0.75rem",padding:"0.3rem 0.6rem",borderRadius:6,border:"1px solid #D1D5DB",background:"white",color:"#0C512F"},children:"Reset Password"}),(0,t.jsx)("button",{type:"button",className:"btn",onClick:()=>I(e),disabled:C===e.id,style:{fontSize:"0.75rem",padding:"0.3rem 0.6rem",borderRadius:6,border:"1px solid #FCA5A5",background:"#FEF2F2",color:"#B91C1C"},children:C===e.id?"Deleting...":"Delete"})]})]},e.id))})]}),w&&(0,t.jsxs)("div",{style:{marginTop:"0.9rem",borderRadius:10,border:"1px solid #E5E7EB",padding:"0.9rem",background:"#F9FAFB"},children:[(0,t.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[(0,t.jsxs)("h3",{style:{fontSize:"0.95rem",color:"#0C512F",margin:0},children:["Reset Password for:"," ",(0,t.jsx)("span",{style:{fontWeight:600},children:w.username})]}),(0,t.jsx)("button",{type:"button",className:"btn",onClick:()=>{j(null),v("")},style:{fontSize:"0.75rem",padding:"0.25rem 0.5rem",borderRadius:6,border:"1px solid #D1D5DB",background:"white"},children:"Close"})]}),(0,t.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.6rem",alignItems:"flex-end"},children:[(0,t.jsxs)("div",{style:{flex:"1 1 220px"},children:[(0,t.jsx)("label",{style:{display:"block",fontSize:"0.8rem",marginBottom:4,color:"#4B5563"},children:"New Password"}),(0,t.jsx)("input",{className:"input",type:"text",placeholder:"Enter or generate new password",value:S,onChange:e=>v(e.target.value)}),(0,t.jsx)("small",{style:{fontSize:"0.7rem",color:"#6B7280"},children:"Share this new password securely with the user."})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("button",{type:"button",className:"btn",onClick:()=>{let e="ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz23456789!@#$",r="";for(let s=0;s<10;s++)r+=e[Math.floor(Math.random()*e.length)];v(r)},style:{whiteSpace:"nowrap",fontSize:"0.75rem",padding:"0.4rem 0.7rem",borderRadius:6,border:"1px solid #D1D5DB",background:"white",marginBottom:"0.25rem"},children:"Generate Password"}),(0,t.jsx)("button",{type:"button",className:"btn-primary",onClick:A,disabled:D,style:{display:"block",marginTop:"0.25rem",border:"none",padding:"0.45rem 0.8rem",borderRadius:6,background:"#0C512F",color:"white",fontSize:"0.8rem",whiteSpace:"nowrap"},children:D?"Saving...":"Save New Password"})]})]})]})]})]})]})})}}},function(e){e.O(0,[66,664,888,774,179],function(){return e(e.s=2257)}),_N_E=e.O()}]);