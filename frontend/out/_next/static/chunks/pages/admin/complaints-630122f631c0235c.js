(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[239],{5416:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/complaints",function(){return n(7894)}])},9046:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var a=n(5893),r=n(1664),i=n.n(r),l=n(1013),s=n(7294);function o(e){let{children:t}=e,[n,r]=(0,s.useState)(null),[i,o]=(0,s.useState)(null),[c,u]=(0,s.useState)(!1);(0,s.useEffect)(()=>{r((0,l.cY)()),o((0,l.Ms)())},[]);let h="ADMIN"===n,g="SR_REGISTRAR"===n,p="DO"===n;return(0,a.jsxs)("div",{style:{minHeight:"100vh",display:"flex",background:"#f6f6f6",fontFamily:"sans-serif"},children:[(0,a.jsxs)("aside",{className:"print-hidden",onMouseEnter:()=>u(!1),onMouseLeave:()=>u(!0),style:{width:c?"70px":"240px",background:"#0C512F",color:"white",transition:"width 0.25s ease",overflow:"hidden",boxShadow:"2px 0 5px rgba(0,0,0,0.1)"},children:[(0,a.jsxs)("div",{style:{padding:"1rem",borderBottom:"1px solid rgba(255,255,255,0.15)",display:"flex",alignItems:"center",gap:"0.75rem"},children:[(0,a.jsx)("img",{src:"/ogra-logo.png",alt:"OGRA Logo",style:{width:"36px",height:"36px",objectFit:"contain"}}),!c&&(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{fontWeight:700,fontSize:"0.95rem",lineHeight:"1.2"},children:"OGRA Dashboard"}),(0,a.jsx)("div",{style:{fontSize:"0.7rem",opacity:.8},children:"ADMIN"===n?"REGISTRAR":"".concat(i||"DO User"," (").concat(n||"No Role",")")})]})]}),(0,a.jsxs)("nav",{style:{padding:"0.75rem 0.5rem"},children:[(0,a.jsx)(d,{href:"/admin",label:"Dashboard",collapsed:c}),(h||g||p)&&(0,a.jsx)(d,{href:"/admin/complaints",label:"Complaints",collapsed:c}),(p||h)&&(0,a.jsx)(d,{href:"/admin/do",label:"DO Dashboard",collapsed:c}),(h||g)&&(0,a.jsx)(d,{href:"/admin/company-dashboard",label:"Company Dashboard",collapsed:c}),h&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d,{href:"/admin/users",label:"Manage Users",collapsed:c}),(0,a.jsx)(d,{href:"/admin/master-data",label:"Form Settings",collapsed:c})]})]}),(0,a.jsx)("div",{style:{marginTop:"auto",padding:"1rem",borderTop:"1px solid rgba(255,255,255,0.15)"},children:(0,a.jsx)("button",{onClick:()=>{(0,l.qz)(),window.location.href="/admin/login"},style:{width:"100%",padding:"0.5rem",background:"#3AA469",border:"none",borderRadius:"4px",color:"white",fontSize:"0.8rem",cursor:"pointer"},children:c?"âŽ‹":"Logout"})})]}),(0,a.jsx)("main",{style:{flex:1,padding:"1.5rem"},children:(0,a.jsx)("div",{style:{maxWidth:1300,margin:"0 auto"},children:t})})]})}function d(e){let{href:t,label:n,collapsed:r}=e;return(0,a.jsx)("div",{style:{marginBottom:"0.3rem"},children:(0,a.jsxs)(i(),{href:t,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.45rem 0.6rem",borderRadius:"6px",textDecoration:"none",color:"white",fontSize:"0.85rem",transition:"background 0.2s, transform 0.1s"},children:[(0,a.jsx)("span",{style:{width:"8px",height:"8px",background:"#3AA469",borderRadius:"50%"}}),!r&&(0,a.jsx)("span",{style:{fontSize:"0.85rem"},children:n})]})})}},9875:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});var a=n(5893);function r(e){let{tone:t="gray",children:n}=e,r={};switch(t){case"green":r={background:"#0C512F"};break;case"yellow":r={background:"#D97706"};break;case"blue":r={background:"#2563EB"};break;case"red":r={background:"#DC2626"};break;default:r={background:"#6B7280"}}return(0,a.jsx)("span",{style:{display:"inline-block",padding:"3px 8px",borderRadius:"6px",fontSize:"0.75rem",fontWeight:600,color:"white",textTransform:"capitalize",...r},children:n})}},3139:function(e,t,n){"use strict";n.d(t,{S:function(){return r}});let a="https://complaint.ogra.org.pk";if(!a){let{protocol:e,hostname:t}=window.location;a="".concat(e,"//").concat(t,":5000")}a||(a="http://localhost:5000");let r="https://complaint.ogra.org.pk"},1013:function(e,t,n){"use strict";function a(){return localStorage.getItem("token")||null}function r(e){e&&localStorage.setItem("token",e)}function i(){localStorage.removeItem("token"),localStorage.removeItem("role"),localStorage.removeItem("username")}function l(){let e=a();return e?{Authorization:"Bearer "+e}:{}}function s(e,t){e&&localStorage.setItem("role",e),t&&localStorage.setItem("username",t)}function o(){return localStorage.getItem("role")}function d(){return localStorage.getItem("username")}n.d(t,{$V:function(){return l},IO:function(){return s},LP:function(){return a},Ms:function(){return d},cY:function(){return o},o4:function(){return r},qz:function(){return i}})},7894:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return g}});var a=n(5893),r=n(7294),i=n(7066),l=n(9046),s=n(3139),o=n(1013),d=n(1664),c=n.n(d),u=n(9875);function h(e){let t=new Date,n=new Date(t.getFullYear(),t.getMonth(),t.getDate()),a=new Date(n);a.setDate(a.getDate()-1);let r={today:[],yesterday:[],earlier:[]};return e.forEach(e=>{let t=new Date(e.createdAt);t>=n?r.today.push(e):t>=a&&t<n?r.yesterday.push(e):r.earlier.push(e)}),r}function g(){let[e,t]=(0,r.useState)({items:[],total:0,pages:1,page:1}),[n,d]=(0,r.useState)([]),[g,p]=(0,r.useState)(null),[m,x]=(0,r.useState)(""),[f,y]=(0,r.useState)(""),[j,b]=(0,r.useState)(""),[w,S]=(0,r.useState)(!1),[v,k]=(0,r.useState)(""),C=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;S(!0),k("");let n=new URLSearchParams;n.set("page",String(e)),g&&n.set("statusId",String(g));try{let e=await i.Z.get(s.S+"/api/complaints?"+n.toString(),{headers:(0,o.$V)()});t(e.data)}catch(e){console.error(e),k("Error fetching complaint data.")}finally{S(!1)}};(0,r.useEffect)(()=>{i.Z.get(s.S+"/api/master/statuses").then(e=>{let t=e.data||[];d(t);let n=t.find(e=>"Pending"===e.name);n?p(String(n.id)):p("")})},[]),(0,r.useEffect)(()=>{null!==g&&C(1)},[g]);let R=e=>{if(!f&&!j)return!0;let t=new Date(e.createdAt);return!!Number.isNaN(t.getTime())||!(f&&t<new Date(f+"T00:00:00")||j&&t>new Date(j+"T23:59:59.999"))},D=(e.items||[]).filter(e=>(e.trackingId.toLowerCase().includes(m.toLowerCase())||"".concat(e.firstName," ").concat(e.lastName).toLowerCase().includes(m.toLowerCase()))&&R(e)),N=async(t,n)=>{try{await i.Z.patch(s.S+"/api/complaints/"+t+"/status",{statusId:n},{headers:(0,o.$V)()}),C(e.page)}catch(e){var a,r;alert((null==e?void 0:null===(r=e.response)||void 0===r?void 0:null===(a=r.data)||void 0===a?void 0:a.message)||"Only Admin can change status")}},I=async()=>{let e=new URLSearchParams;e.set("format","csv"),f&&e.set("from",f),j&&e.set("to",j),g&&e.set("statusId",String(g));let t=await i.Z.get(s.S+"/api/complaints/export/file?"+e.toString(),{headers:(0,o.$V)(),responseType:"blob"}),n=window.URL.createObjectURL(new Blob([t.data])),a=document.createElement("a");a.href=n,a.download="complaints.csv",a.click()},T=D||[];h(T);let A=(e,t)=>t.length?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:6,style:{paddingTop:"0.8rem",paddingBottom:"0.4rem"},children:(0,a.jsx)("span",{style:{background:"#0C512F",color:"white",padding:"3px 10px",borderRadius:"4px",fontSize:"0.75rem",fontWeight:600},children:e})})}),t.map(e=>{var t,r,i,l,s;return(0,a.jsxs)("tr",{style:{borderTop:"1px solid #e5e7eb"},children:[(0,a.jsx)("td",{children:(0,a.jsx)(c(),{href:"/admin/view/".concat(e.id),style:{color:"#0C512F",fontWeight:600},children:e.trackingId})}),(0,a.jsxs)("td",{children:[e.firstName," ",e.lastName||""]}),(0,a.jsx)("td",{children:(0,a.jsx)(u.Z,{tone:(null===(t=e.status)||void 0===t?void 0:t.name)==="Closed"?"green":(null===(r=e.status)||void 0===r?void 0:r.name)==="In Progress"?"yellow":"gray",children:null===(i=e.status)||void 0===i?void 0:i.name})}),(0,a.jsx)("td",{children:(null===(l=e.assignedTo)||void 0===l?void 0:l.username)==="adminogra"?"SR. REGISTRAR":(null===(s=e.assignedTo)||void 0===s?void 0:s.username)||"-"}),(0,a.jsx)("td",{children:(0,a.jsxs)("select",{className:"input",style:{width:150},defaultValue:"",onChange:t=>N(e.id,Number(t.target.value)),children:[(0,a.jsx)("option",{value:"",children:"Change Status"}),n.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})}),(0,a.jsx)("td",{children:new Date(e.createdAt).toLocaleString()})]},e.id)})]}):null;return(0,a.jsxs)(l.Z,{children:[(0,a.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.75rem",gap:"0.5rem",flexWrap:"wrap"},children:[(0,a.jsx)("h1",{style:{fontSize:"1.3rem",fontWeight:700,color:"#0C512F"},children:"Complaints"}),(0,a.jsx)("button",{onClick:I,style:{background:"#0C512F",border:"none",padding:"0.45rem 1rem",color:"white",borderRadius:6,cursor:"pointer"},children:"Export CSV"})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",alignItems:"center"},children:[(0,a.jsx)("input",{type:"text",placeholder:"Search by Tracking ID or Name",value:m,onChange:e=>{x(e.target.value)},className:"input",style:{width:"250px"}}),(0,a.jsxs)("select",{className:"input",style:{maxWidth:220},value:g||"",onChange:e=>p(e.target.value),children:[(0,a.jsx)("option",{value:"",children:"All Statuses"}),n.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,a.jsx)("input",{type:"date",className:"input",style:{width:160},value:f,onChange:e=>y(e.target.value)}),(0,a.jsx)("input",{type:"date",className:"input",style:{width:160},value:j,onChange:e=>b(e.target.value)}),(0,a.jsx)("button",{onClick:()=>{y(""),b(""),x("");let e=n.find(e=>"Pending"===e.name);p(e?String(e.id):""),C(1)},style:{background:"#DC2626",color:"white",padding:"0.45rem 1rem",border:"none",borderRadius:6,cursor:"pointer"},children:"Clear Filters"})]}),v&&(0,a.jsx)("div",{style:{marginTop:"0.5rem",color:"#b91c1c",fontSize:"0.85rem"},children:v})]}),(0,a.jsx)("div",{style:{background:"white",padding:"1rem",borderRadius:8,boxShadow:"0 2px 10px rgba(0,0,0,0.05)"},children:(0,a.jsx)("div",{style:{overflowX:"auto"},children:(0,a.jsxs)("table",{style:{width:"100%",fontSize:"0.85rem",borderCollapse:"collapse"},children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{style:{background:"#0C512F",color:"white"},children:[(0,a.jsx)("th",{style:{padding:"8px"},align:"left",children:"Tracking"}),(0,a.jsx)("th",{style:{padding:"8px"},align:"left",children:"Name"}),(0,a.jsx)("th",{style:{padding:"8px"},align:"left",children:"Status"}),(0,a.jsx)("th",{style:{padding:"8px"},align:"left",children:"Assigned"}),(0,a.jsx)("th",{style:{padding:"8px"},align:"left",children:"Status Change"}),(0,a.jsx)("th",{style:{padding:"8px"},align:"left",children:"Created"})]})}),(0,a.jsx)("tbody",{children:0===h(T).today.length&&0===h(T).yesterday.length&&0===h(T).earlier.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:6,style:{padding:"1rem",textAlign:"center"},children:w?"Loading...":"No complaints found for selected filters."})}):(0,a.jsxs)(a.Fragment,{children:[A("Today",h(T).today),A("Yesterday",h(T).yesterday),A("Earlier",h(T).earlier)]})})]})})})]})}}},function(e){e.O(0,[66,664,888,774,179],function(){return e(e.s=5416)}),_N_E=e.O()}]);